(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[206],{6041:function(e,t,a){Promise.resolve().then(a.bind(a,4028))},4028:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return AdminEventsPage}});var r=a(7437),s=a(2265),n=a(4033),i=a(9727),l=a(5734);function EventList(e){let{events:t,loading:a,onEdit:s,onDelete:n,onStatusChange:i,currentPage:l,totalPages:o,onPageChange:c}=e,formatDate=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),formatPrice=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),getStatusBadge=e=>(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat({active:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",completed:"bg-gray-100 text-gray-800"}[e]),children:e.charAt(0).toUpperCase()+e.slice(1)});return a?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading events..."})]})}):0===t.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,r.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No events"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new event."})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,r.jsx)("div",{className:"aspect-w-16 aspect-h-9",children:(0,r.jsx)("img",{src:e.primaryImage.url,alt:e.title,className:"w-full h-48 object-cover"})}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 line-clamp-2",children:e.title}),getStatusBadge(e.status)]}),(0,r.jsx)("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:e.description}),(0,r.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),formatDate(e.date)]}),(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,r.jsxs)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.location]}),(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.availableSeats," / ",e.totalSeats," seats"]}),(0,r.jsxs)("div",{className:"flex items-center text-sm font-semibold text-primary-600",children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),formatPrice(e.ticketPrice)]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>s(e),className:"flex-1 btn-secondary text-sm py-2",children:"Edit"}),(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsxs)("select",{value:e.status,onChange:t=>i(e._id,t.target.value),className:"text-xs border border-gray-300 rounded px-2 py-1",children:[(0,r.jsx)("option",{value:"active",children:"Active"}),(0,r.jsx)("option",{value:"cancelled",children:"Cancelled"}),(0,r.jsx)("option",{value:"completed",children:"Completed"})]}),(0,r.jsx)("button",{onClick:()=>n(e._id),className:"text-red-600 hover:text-red-800 text-sm px-2 py-1",children:"Delete"})]})]})]})]},e._id))}),o>1&&(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>c(l-1),disabled:1===l,className:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,r.jsxs)("span",{className:"px-3 py-2 text-sm font-medium text-gray-700",children:["Page ",l," of ",o]}),(0,r.jsx)("button",{onClick:()=>c(l+1),disabled:l===o,className:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})}function EventForm(e){let{event:t,onClose:a,onSubmit:n}=e,[i,o]=(0,s.useState)({title:"",description:"",date:"",location:"",totalSeats:"",ticketPrice:""}),[c,d]=(0,s.useState)(null),[m,u]=(0,s.useState)([]),[h,x]=(0,s.useState)(""),[p,g]=(0,s.useState)([]),[v,f]=(0,s.useState)(!1),[y,b]=(0,s.useState)("");(0,s.useEffect)(()=>{t&&(o({title:t.title,description:t.description,date:new Date(t.date).toISOString().slice(0,16),location:t.location,totalSeats:t.totalSeats.toString(),ticketPrice:t.ticketPrice.toString()}),x(t.primaryImage.url),g(t.secondaryImages.map(e=>e.url)))},[t]);let handleChange=e=>{o({...i,[e.target.name]:e.target.value})},removeSecondaryImage=e=>{let t=m.filter((t,a)=>a!==e),a=p.filter((t,a)=>a!==e);u(t),g(a)},handleSubmit=async e=>{e.preventDefault(),f(!0),b("");try{if(t){let e={title:i.title,description:i.description,date:i.date,location:i.location,totalSeats:parseInt(i.totalSeats),ticketPrice:parseFloat(i.ticketPrice)};c&&(e.primaryImage=c),m.length>0&&(e.secondaryImages=m),await l.d.updateEvent(t._id,e)}else{if(!c){b("Primary image is required"),f(!1);return}let e={title:i.title,description:i.description,date:i.date,location:i.location,totalSeats:parseInt(i.totalSeats),ticketPrice:parseFloat(i.ticketPrice),primaryImage:c,secondaryImages:m.length>0?m:void 0};await l.d.createEvent(e)}n()}catch(e){var a,r;b((null===(r=e.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.message)||"Failed to save event")}finally{f(!1)}};return(0,r.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg",children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:t?"Edit Event":"Create New Event"}),(0,r.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,r.jsxs)("form",{onSubmit:handleSubmit,className:"p-6 space-y-6",children:[y&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:y}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"title",className:"form-label",children:"Event Title *"}),(0,r.jsx)("input",{type:"text",id:"title",name:"title",value:i.title,onChange:handleChange,className:"input-field",required:!0,placeholder:"Enter event title"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"date",className:"form-label",children:"Event Date & Time *"}),(0,r.jsx)("input",{type:"datetime-local",id:"date",name:"date",value:i.date,onChange:handleChange,className:"input-field",required:!0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"description",className:"form-label",children:"Description *"}),(0,r.jsx)("textarea",{id:"description",name:"description",value:i.description,onChange:handleChange,className:"input-field",rows:4,required:!0,placeholder:"Describe your event..."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"location",className:"form-label",children:"Location *"}),(0,r.jsx)("input",{type:"text",id:"location",name:"location",value:i.location,onChange:handleChange,className:"input-field",required:!0,placeholder:"Event location"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"totalSeats",className:"form-label",children:"Total Seats *"}),(0,r.jsx)("input",{type:"number",id:"totalSeats",name:"totalSeats",value:i.totalSeats,onChange:handleChange,className:"input-field",min:"1",required:!0,placeholder:"Number of seats"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"ticketPrice",className:"form-label",children:"Ticket Price *"}),(0,r.jsx)("input",{type:"number",id:"ticketPrice",name:"ticketPrice",value:i.ticketPrice,onChange:handleChange,className:"input-field",min:"0",step:"0.01",required:!0,placeholder:"Price per ticket"})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"form-label",children:"Primary Image *"}),(0,r.jsxs)("div",{className:"mt-1",children:[(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){d(a);let e=new FileReader;e.onload=e=>{var t;x(null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(a)}},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100"}),h&&(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)("img",{src:h,alt:"Primary preview",className:"h-32 w-48 object-cover rounded-lg"})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"form-label",children:"Secondary Images (Optional)"}),(0,r.jsxs)("div",{className:"mt-1",children:[(0,r.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{let t=Array.from(e.target.files||[]);u(t);let a=[];t.forEach(e=>{let r=new FileReader;r.onload=e=>{var r;a.push(null===(r=e.target)||void 0===r?void 0:r.result),a.length===t.length&&g(a)},r.readAsDataURL(e)})},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100"}),p.length>0&&(0,r.jsx)("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-4 gap-2",children:p.map((e,t)=>(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("img",{src:e,alt:"Secondary ".concat(t+1),className:"h-20 w-full object-cover rounded-lg"}),(0,r.jsx)("button",{type:"button",onClick:()=>removeSecondaryImage(t),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm hover:bg-red-600",children:"\xd7"})]},t))})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-200",children:[(0,r.jsx)("button",{type:"button",onClick:a,className:"btn-secondary",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:v,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Saving...":t?"Update Event":"Create Event"})]})]})]})})}function AdminEventsPage(){let[e,t]=(0,s.useState)(null),[a,o]=(0,s.useState)(!0),[c,d]=(0,s.useState)([]),[m,u]=(0,s.useState)(!1),[h,x]=(0,s.useState)(null),[p,g]=(0,s.useState)(1),[v,f]=(0,s.useState)(1),[y,b]=(0,s.useState)(!1),j=(0,n.useRouter)();(0,s.useEffect)(()=>{let checkAuth=async()=>{let e=(0,i.bW)();if(!e){j.push("/");return}try{let e=await i.kv.getCurrentUser();if("admin"!==e.user.role){(0,i.H6)(),j.push("/");return}t(e.user)}catch(e){(0,i.H6)(),j.push("/")}finally{o(!1)}};checkAuth()},[j]),(0,s.useEffect)(()=>{e&&loadEvents()},[e,p]);let loadEvents=async()=>{b(!0);try{let e=await l.d.getEvents(p,10,"all");d(e.events),f(e.totalPages)}catch(e){console.error("Error loading events:",e)}finally{b(!1)}},handleFormSubmit=async()=>{u(!1),x(null),await loadEvents()},handleDeleteEvent=async e=>{if(window.confirm("Are you sure you want to delete this event?"))try{await l.d.deleteEvent(e),await loadEvents()}catch(e){console.error("Error deleting event:",e),alert("Failed to delete event")}},handleStatusChange=async(e,t)=>{try{await l.d.updateEventStatus(e,t),await loadEvents()}catch(e){console.error("Error updating event status:",e),alert("Failed to update event status")}};return a?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,r.jsx)("div",{className:"flex items-center space-x-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Event Management"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Manage your events"})]})}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("button",{onClick:()=>{x(null),u(!0)},className:"btn-primary",children:"+ Create Event"}),(0,r.jsx)("button",{onClick:()=>{(0,i.H6)(),j.push("/")},className:"btn-secondary",children:"Logout"})]})]})})}),(0,r.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:m?(0,r.jsx)(EventForm,{event:h,onClose:()=>{u(!1),x(null)},onSubmit:handleFormSubmit}):(0,r.jsx)(EventList,{events:c,loading:y,onEdit:e=>{x(e),u(!0)},onDelete:handleDeleteEvent,onStatusChange:handleStatusChange,currentPage:p,totalPages:v,onPageChange:g})})]})}},9727:function(e,t,a){"use strict";a.d(t,{H6:function(){return removeAuthToken},bW:function(){return getAuthToken},kv:function(){return n},uB:function(){return setAuthToken}});var r=a(4771),s=a(1490);a(2265);let n={login:async(e,t)=>{let a=await r.Z.post("/auth/login",{email:e,password:t});return a.data},register:async(e,t,a,s)=>{let n=await r.Z.post("/auth/register",{name:e,email:t,password:a,role:s});return n.data},getCurrentUser:async()=>{let e=s.Z.get("token"),t=await r.Z.get("/auth/me",{headers:{Authorization:"Bearer ".concat(e)}});return t.data}},setAuthToken=e=>{s.Z.set("token",e,{expires:7})},removeAuthToken=()=>{s.Z.remove("token")},getAuthToken=()=>s.Z.get("token")},4771:function(e,t,a){"use strict";var r=a(4829),s=a(1490),n=a(5267);let i=r.Z.create({baseURL:"https://kretoss-task.onrender.com/api",timeout:3e4,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>{var t;(null===(t=e.url)||void 0===t?void 0:t.includes("health"))||(0,n.VO)();let a=s.Z.get("token");return a&&(e.headers||(e.headers={}),e.headers.Authorization||(e.headers.Authorization="Bearer ".concat(a))),e},e=>((0,n.Gx)(),Promise.reject(e))),i.interceptors.response.use(e=>((0,n.Gx)(),e),e=>{var t;return(0,n.Gx)(),(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(s.Z.remove("token"),window.location.href="/"),Promise.reject(e)}),t.Z=i},5734:function(e,t,a){"use strict";a.d(t,{d:function(){return n}});var r=a(4771),s=a(9727);let n={getEvents:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"active",s=await r.Z.get("/events",{params:{page:e,limit:t,status:a}});return s.data},getEvent:async e=>{let t=await r.Z.get("/events/".concat(e));return t.data},createEvent:async e=>{let t=(0,s.bW)(),a=new FormData;a.append("title",e.title),a.append("description",e.description),a.append("date",e.date),a.append("location",e.location),a.append("totalSeats",e.totalSeats.toString()),a.append("ticketPrice",e.ticketPrice.toString()),a.append("primaryImage",e.primaryImage),e.secondaryImages&&e.secondaryImages.forEach((e,t)=>{a.append("secondaryImages",e)});let n=await r.Z.post("/events",a,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(t)}});return n.data},updateEvent:async(e,t)=>{let a=(0,s.bW)(),n=new FormData;t.title&&n.append("title",t.title),t.description&&n.append("description",t.description),t.date&&n.append("date",t.date),t.location&&n.append("location",t.location),t.totalSeats&&n.append("totalSeats",t.totalSeats.toString()),t.ticketPrice&&n.append("ticketPrice",t.ticketPrice.toString()),t.primaryImage&&n.append("primaryImage",t.primaryImage),t.secondaryImages&&t.secondaryImages.forEach(e=>{n.append("secondaryImages",e)});let i=await r.Z.put("/events/".concat(e),n,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(a)}});return i.data},deleteEvent:async e=>{let t=(0,s.bW)();await r.Z.delete("/events/".concat(e),{headers:{Authorization:"Bearer ".concat(t)}})},updateEventStatus:async(e,t)=>{let a=(0,s.bW)(),n=await r.Z.patch("/events/".concat(e,"/status"),{status:t},{headers:{Authorization:"Bearer ".concat(a)}});return n.data}}},5267:function(e,t,a){"use strict";a.d(t,{Gx:function(){return hideLoader},RF:function(){return isLoaderVisible},VO:function(){return showLoader},Yb:function(){return subscribeLoader}});let r=!1,s=new Set;function showLoader(){r||(r=!0,s.forEach(e=>e(!0)))}function hideLoader(){r&&(r=!1,s.forEach(e=>e(!1)))}function subscribeLoader(e){return s.add(e),()=>s.delete(e)}function isLoaderVisible(){return r}}},function(e){e.O(0,[745,971,864,744],function(){return e(e.s=6041)}),_N_E=e.O()}]);