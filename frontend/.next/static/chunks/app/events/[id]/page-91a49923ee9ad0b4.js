(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[857],{6298:function(e,t,a){Promise.resolve().then(a.bind(a,426))},426:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return EventDetailsPage}});var n=a(7437),r=a(2265),o=a(4033),s=a(5734),i=a(9727),c=a(4771);function EventDetailsPage(){let e=(0,o.useParams)(),t=(0,o.useRouter)(),[a,d]=(0,r.useState)(null),[l,u]=(0,r.useState)(!0),[p,h]=(0,r.useState)(""),m=(0,r.useMemo)(()=>{if(e&&e.id)return Array.isArray(e.id)?e.id[0]:e.id},[e]);(0,r.useEffect)(()=>{let e=!0,load=async()=>{if(m)try{let t=await s.d.getEvent(m);e&&d(t)}catch(t){e&&h("Failed to load event")}finally{e&&u(!1)}};return u(!0),load(),()=>{e=!1}},[m]);let bookEvent=async()=>{try{let e=(0,i.bW)();if(!e){t.push("/");return}if(!a){alert("Event not found");return}if(a.availableSeats<=0){alert("This event is sold out");return}console.log("Creating checkout session for event:",a._id);let n=await c.Z.post("/checkout/create-session",{eventId:a._id});if(console.log("Checkout session response:",n.data),n.data&&n.data.url)console.log("Redirecting to Stripe checkout:",n.data.url),window.location.href=n.data.url;else throw console.error("No checkout URL in response:",n.data),Error("No checkout URL received")}catch(a){var e,n;console.error("Payment error:",a);let t=(null===(n=a.response)||void 0===n?void 0:null===(e=n.data)||void 0===e?void 0:e.message)||a.message||"Failed to start checkout";alert("Payment Error: ".concat(t))}};return l?null:p||!a?(0,n.jsx)("div",{className:"p-6 text-red-600",children:p||"Event not found"}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,n.jsx)("main",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,n.jsx)("img",{src:a.primaryImage.url,alt:a.title,className:"w-full h-80 object-cover"}),(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:a.title}),(0,n.jsx)("p",{className:"mt-3 text-gray-700",children:a.description}),(0,n.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-600",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Date:"})," ",new Date(a.date).toLocaleString()]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Location:"})," ",a.location]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Seats:"})," ",a.availableSeats," / ",a.totalSeats]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Price:"})," $",a.ticketPrice.toFixed(2)]})]}),a.secondaryImages.length>0&&(0,n.jsx)("div",{className:"mt-6 grid grid-cols-2 md:grid-cols-4 gap-3",children:a.secondaryImages.map(e=>(0,n.jsx)("img",{src:e.url,alt:a.title,className:"h-24 w-full object-cover rounded"},e.publicId))}),(0,n.jsx)("div",{className:"mt-8",children:(0,n.jsx)("button",{onClick:bookEvent,disabled:a.availableSeats<=0,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:a.availableSeats>0?"Book / Purchase Ticket":"Sold Out"})})]})]})})})}},9727:function(e,t,a){"use strict";a.d(t,{H6:function(){return removeAuthToken},bW:function(){return getAuthToken},kv:function(){return o},uB:function(){return setAuthToken}});var n=a(4771),r=a(1490);a(2265);let o={login:async(e,t)=>{let a=await n.Z.post("/auth/login",{email:e,password:t});return a.data},register:async(e,t,a,r)=>{let o=await n.Z.post("/auth/register",{name:e,email:t,password:a,role:r});return o.data},getCurrentUser:async()=>{let e=r.Z.get("token"),t=await n.Z.get("/auth/me",{headers:{Authorization:"Bearer ".concat(e)}});return t.data}},setAuthToken=e=>{r.Z.set("token",e,{expires:7})},removeAuthToken=()=>{r.Z.remove("token")},getAuthToken=()=>r.Z.get("token")},4771:function(e,t,a){"use strict";var n=a(4829),r=a(1490),o=a(5267);let s=n.Z.create({baseURL:"https://kretoss-task.onrender.com/api",timeout:3e4,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{var t;(null===(t=e.url)||void 0===t?void 0:t.includes("health"))||(0,o.VO)();let a=r.Z.get("token");if(a){let t=e.headers||{};t.Authorization="Bearer ".concat(a),e.headers=t}return e},e=>((0,o.Gx)(),Promise.reject(e))),s.interceptors.response.use(e=>((0,o.Gx)(),e),e=>{var t;return(0,o.Gx)(),(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(r.Z.remove("token"),window.location.href="/"),Promise.reject(e)}),t.Z=s},5734:function(e,t,a){"use strict";a.d(t,{d:function(){return o}});var n=a(4771),r=a(9727);let o={getEvents:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"active",r=await n.Z.get("/events",{params:{page:e,limit:t,status:a}});return r.data},getEvent:async e=>{let t=await n.Z.get("/events/".concat(e));return t.data},createEvent:async e=>{let t=(0,r.bW)(),a=new FormData;a.append("title",e.title),a.append("description",e.description),a.append("date",e.date),a.append("location",e.location),a.append("totalSeats",e.totalSeats.toString()),a.append("ticketPrice",e.ticketPrice.toString()),a.append("primaryImage",e.primaryImage),e.secondaryImages&&e.secondaryImages.forEach((e,t)=>{a.append("secondaryImages",e)});let o=await n.Z.post("/events",a,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(t)}});return o.data},updateEvent:async(e,t)=>{let a=(0,r.bW)(),o=new FormData;t.title&&o.append("title",t.title),t.description&&o.append("description",t.description),t.date&&o.append("date",t.date),t.location&&o.append("location",t.location),t.totalSeats&&o.append("totalSeats",t.totalSeats.toString()),t.ticketPrice&&o.append("ticketPrice",t.ticketPrice.toString()),t.primaryImage&&o.append("primaryImage",t.primaryImage),t.secondaryImages&&t.secondaryImages.forEach(e=>{o.append("secondaryImages",e)});let s=await n.Z.put("/events/".concat(e),o,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(a)}});return s.data},deleteEvent:async e=>{let t=(0,r.bW)();await n.Z.delete("/events/".concat(e),{headers:{Authorization:"Bearer ".concat(t)}})},updateEventStatus:async(e,t)=>{let a=(0,r.bW)(),o=await n.Z.patch("/events/".concat(e,"/status"),{status:t},{headers:{Authorization:"Bearer ".concat(a)}});return o.data}}},5267:function(e,t,a){"use strict";a.d(t,{Gx:function(){return hideLoader},RF:function(){return isLoaderVisible},VO:function(){return showLoader},Yb:function(){return subscribeLoader}});let n=!1,r=new Set;function showLoader(){n||(n=!0,r.forEach(e=>e(!0)))}function hideLoader(){n&&(n=!1,r.forEach(e=>e(!1)))}function subscribeLoader(e){return r.add(e),()=>r.delete(e)}function isLoaderVisible(){return n}}},function(e){e.O(0,[745,971,864,744],function(){return e(e.s=6298)}),_N_E=e.O()}]);